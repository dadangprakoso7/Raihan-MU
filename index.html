<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analisis Komentar Instagram - Manchester United</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #dc2626 0%, #7f1d1d 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        .instagram-post {
            border: 1px solid #dbdbdb;
            border-radius: 8px;
            background: white;
            max-width: 600px;
            margin: 0 auto;
        }
        .comment-emoji {
            font-size: 1.2em;
        }
        .analysis-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 4px;
            margin-bottom: 4px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-8">
            <h1 class="text-4xl font-bold mb-2">Analisis Komentar Instagram MU</h1>
            <p class="text-red-100 text-lg">Analisis Kualitatif 3 Level Komentar @manchesterunited</p>
            <p class="text-red-200 text-sm mt-2">Sentimen ‚Ä¢ Ekspresi ‚Ä¢ Ritual Thread</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        
        <!-- URL Input Section -->
        <section class="mb-12 fade-in">
            <div class="bg-white rounded-lg shadow-lg p-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Analisis Komentar Instagram</h2>
                
                <div class="mb-8">
                    <div class="bg-red-50 border-l-4 border-red-600 p-6 mb-6">
                        <h3 class="text-xl font-bold text-red-900 mb-3">Panduan Penggunaan:</h3>
                        <ol class="text-red-800 space-y-2 pl-5 list-decimal">
                            <li>Masukkan URL postingan Instagram @manchesterunited</li>
                            <li>Sistem akan mengambil komentar secara langsung</li>
                            <li>Analisis kualitatif 3 level akan dijalankan</li>
                            <li>Hasil analisis dapat diunduh sebagai laporan</li>
                        </ol>
                    </div>
                    
                    <!-- Input Section -->
                    <div class="bg-white border border-gray-200 rounded-lg p-6 mb-4">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Masukkan URL Postingan</h3>
                        <div class="flex flex-col md:flex-row gap-4 mb-4">
                            <input type="text" id="instagramUrl" 
                                   placeholder="Contoh: https://www.instagram.com/p/CxHhXZvqQk/" 
                                   class="flex-grow px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                                   value="https://www.instagram.com/p/CxHhXZvqQk/">
                            <button id="analyzeBtn" 
                                    class="px-8 py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition-colors flex items-center justify-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                                Analisis Komentar
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div class="flex items-center text-gray-600">
                                <input type="radio" id="methodApi" name="analysisMethod" value="api" class="mr-2" checked>
                                <label for="methodApi" class="text-sm">Instagram Graph API</label>
                            </div>
                            <div class="flex items-center text-gray-600">
                                <input type="radio" id="methodMock" name="analysisMethod" value="mock" class="mr-2">
                                <label for="methodMock" class="text-sm">Data Contoh (Mock)</label>
                            </div>
                            <div class="flex items-center text-gray-600">
                                <input type="radio" id="methodScrape" name="analysisMethod" value="scrape" class="mr-2">
                                <label for="methodScrape" class="text-sm">Web Scraping</label>
                            </div>
                        </div>
                        
                        <div class="text-sm text-gray-600 bg-gray-50 p-3 rounded-lg">
                            <div class="flex items-start">
                                <svg class="w-5 h-5 mr-2 mt-0.5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <div>
                                    <p class="font-medium">Catatan:</p>
                                    <p>Instagram Graph API memerlukan token akses. Untuk pengujian, gunakan opsi "Data Contoh" atau siapkan backend dengan token Instagram yang valid.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="loadingState" class="hidden text-center py-12">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"></div>
                    <p class="text-gray-600 font-medium" id="loadingMessage">Mengambil data dari Instagram...</p>
                    <div class="w-full bg-gray-200 rounded-full h-2 mt-4 max-w-md mx-auto">
                        <div id="progressBar" class="bg-red-600 h-2 rounded-full w-0"></div>
                    </div>
                    <p class="text-gray-500 text-sm mt-2" id="loadingDetail">Menyiapkan analisis kualitatif 3 level</p>
                </div>

                <!-- Error State -->
                <div id="errorState" class="hidden bg-red-50 border border-red-200 rounded-lg p-6 mb-8">
                    <div class="flex items-center text-red-800 mb-3">
                        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <h3 class="text-lg font-bold" id="errorTitle">Error</h3>
                    </div>
                    <p class="text-red-700" id="errorMessage"></p>
                    <button id="tryAgainBtn" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                        Coba Lagi
                    </button>
                </div>

                <!-- Results Container -->
                <div id="resultsContainer" class="hidden">
                    <!-- Post Info -->
                    <div class="bg-gradient-to-r from-red-50 to-pink-50 rounded-lg p-6 mb-8 border border-red-100">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                            <div>
                                <h3 class="text-xl font-bold text-gray-800 mb-2" id="postTitle">Postingan Instagram</h3>
                                <p class="text-gray-600 break-all" id="postUrl"></p>
                                <div class="flex flex-wrap items-center mt-2 gap-2">
                                    <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium" id="totalCommentsBadge">0 komentar</span>
                                    <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium" id="analysisDate"></span>
                                    <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium" id="analysisMethod"></span>
                                </div>
                            </div>
                            <div class="flex flex-wrap gap-2 mt-4 md:mt-0">
                                <button id="newAnalysisBtn" class="px-4 py-2 border border-red-600 text-red-600 font-medium rounded-lg hover:bg-red-50 transition-colors">
                                    Analisis Baru
                                </button>
                                <button id="downloadReportBtn" class="px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition-colors flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    Unduh Laporan
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Post Preview -->
                    <div class="instagram-post p-4 mb-8">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center mr-3">
                                <span class="text-red-600 font-bold">MU</span>
                            </div>
                            <div>
                                <p class="font-bold text-gray-800">manchesterunited</p>
                                <p class="text-gray-500 text-sm">Manchester United Official</p>
                            </div>
                        </div>
                        <div class="mb-4">
                            <p class="text-gray-800" id="postCaption">Memuat caption postingan...</p>
                            <p class="text-gray-500 text-sm mt-2" id="postTimestamp"></p>
                        </div>
                        <div class="border-t border-gray-200 pt-4">
                            <div class="flex items-center text-gray-600 mb-2">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                </svg>
                                <span id="postLikes">0</span> suka
                            </div>
                            <div class="flex items-center text-gray-600">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                </svg>
                                <span id="postCommentsCount">0</span> komentar
                            </div>
                        </div>
                    </div>

                    <!-- Analysis Overview -->
                    <div class="grid md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow-lg p-6 card-hover fade-in">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="font-bold text-blue-700 text-lg">Sentimen (Individu)</h4>
                                <div class="bg-blue-100 rounded-full p-2">
                                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <p class="text-sm text-gray-500 mb-1">Emosi Dominan</p>
                                    <p class="font-bold text-blue-800" id="dominantEmotion">Memuat...</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500 mb-1">Intensitas</p>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div id="intensityBar" class="bg-blue-600 h-2 rounded-full"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-lg p-6 card-hover fade-in">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="font-bold text-purple-700 text-lg">Ekspresi (Interpersonal)</h4>
                                <div class="bg-purple-100 rounded-full p-2">
                                    <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <p class="text-sm text-gray-500 mb-1">Interaksi Terbanyak</p>
                                    <p class="font-bold text-purple-800" id="dominantInteraction">Memuat...</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500 mb-1">Pengguna Aktif</p>
                                    <p class="font-bold text-purple-800" id="activeUsers">0</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-lg p-6 card-hover fade-in">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="font-bold text-orange-700 text-lg">Ritual (Kelompok)</h4>
                                <div class="bg-orange-100 rounded-full p-2">
                                    <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <p class="text-sm text-gray-500 mb-1">Ritual Teridentifikasi</p>
                                    <p class="font-bold text-orange-800" id="ritualCount">0</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500 mb-1">Rantai Terpanjang</p>
                                    <p class="font-bold text-orange-800" id="longestChain">0 komentar</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Comments Analysis -->
                    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-bold text-gray-800">Analisis Komentar</h3>
                            <div class="flex items-center space-x-2">
                                <input type="text" id="searchComments" placeholder="Cari komentar..." 
                                       class="px-4 py-2 border border-gray-300 rounded-lg text-sm">
                                <select id="sortComments" class="px-4 py-2 border border-gray-300 rounded-lg text-sm">
                                    <option value="newest">Terbaru</option>
                                    <option value="oldest">Terlama</option>
                                    <option value="sentiment">Sentimen</option>
                                    <option value="length">Panjang Komentar</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="overflow-y-auto max-h-96" id="commentsContainer">
                            <!-- Comments will be loaded here -->
                        </div>
                        
                        <div class="mt-4 flex justify-between items-center">
                            <div class="text-sm text-gray-600">
                                Menampilkan <span id="showingComments">0</span> dari <span id="totalComments">0</span> komentar
                            </div>
                            <div class="flex gap-2">
                                <button id="prevComments" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 disabled:opacity-50">
                                    ‚Üê Sebelumnya
                                </button>
                                <button id="nextComments" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50">
                                    Selanjutnya ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Section -->
                    <div class="grid md:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h4 class="text-xl font-bold text-gray-700 mb-4">Distribusi Level Analisis</h4>
                            <canvas id="analysisChart"></canvas>
                        </div>
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h4 class="text-xl font-bold text-gray-700 mb-4">Pola Komunikasi</h4>
                            <canvas id="patternsChart"></canvas>
                        </div>
                    </div>

                    <!-- Qualitative Insights -->
                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg shadow-lg p-8 mb-8 border border-blue-100">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6">Insight Kualitatif</h3>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <h4 class="text-xl font-bold text-blue-700 mb-4">Pola yang Teridentifikasi</h4>
                                <div class="space-y-4" id="patternsList">
                                    <!-- Patterns will be loaded here -->
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="text-xl font-bold text-purple-700 mb-4">Rekomendasi Analisis</h4>
                                <div class="space-y-4">
                                    <div class="bg-white p-4 rounded-lg border border-purple-100">
                                        <h5 class="font-bold text-purple-800 mb-2">Analisis Diskursus</h5>
                                        <p class="text-sm text-gray-700">Lakukan analisis wacana pada komentar dengan pola ritual untuk memahami konstruksi identitas kelompok.</p>
                                    </div>
                                    <div class="bg-white p-4 rounded-lg border border-blue-100">
                                        <h5 class="font-bold text-blue-800 mb-2">Studi Etnografi Virtual</h5>
                                        <p class="text-sm text-gray-700">Observasi partisipatif terhadap interaksi berulang untuk memahami dinamika komunitas.</p>
                                    </div>
                                    <div class="bg-white p-4 rounded-lg border border-orange-100">
                                        <h5 class="font-bold text-orange-800 mb-2">Analisis Konteks Emosional</h5>
                                        <p class="text-sm text-gray-700">Pelajari hubungan antara performa tim dengan pola emosi dalam komentar.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-12">
        <div class="container mx-auto px-4 py-6 text-center">
            <p>&copy; 2026 Analisis Komentar Instagram - Manchester United</p>
            <p class="text-sm text-gray-400 mt-2">Penelitian Kualitatif: Analisis 3 Level Komunikasi Daring</p>
            <p class="text-xs text-gray-500 mt-1">Catatan: Aplikasi memerlukan akses Instagram Graph API untuk data real-time</p>
        </div>
    </footer>

    <script>
        // Configuration
        const CONFIG = {
            INSTAGRAM_API_URL: 'https://graph.instagram.com',
            MOCK_API_URL: 'https://jsonplaceholder.typicode.com/comments',
            BACKEND_URL: 'http://localhost:3000/api', // Change to your backend URL
            COMMENTS_PER_PAGE: 10,
            MOCK_DATA: [
                {
                    id: 1,
                    text: "GOAT üêêüêêüêê",
                    username: "mu_fan_1",
                    timestamp: "2024-02-05T10:30:00Z",
                    like_count: 45
                },
                {
                    id: 2,
                    text: "Bruno deserves better üò¢",
                    username: "red_devil_22",
                    timestamp: "2024-02-05T10:32:00Z",
                    like_count: 12
                },
                {
                    id: 3,
                    text: "SIUUUUUUUUU üî•",
                    username: "ronaldo_fan",
                    timestamp: "2024-02-05T10:35:00Z",
                    like_count: 89
                },
                {
                    id: 4,
                    text: "When will we win the league again?",
                    username: "old_trafford_legend",
                    timestamp: "2024-02-05T10:40:00Z",
                    like_count: 23
                },
                {
                    id: 5,
                    text: "@manutd please sign a proper striker",
                    username: "transfer_news",
                    timestamp: "2024-02-05T10:45:00Z",
                    like_count: 34
                },
                {
                    id: 6,
                    text: "Rashford on fire today! üî•üî•",
                    username: "marcus_fan",
                    timestamp: "2024-02-05T10:50:00Z",
                    like_count: 67
                },
                {
                    id: 7,
                    text: "GGMU ‚ù§Ô∏è",
                    username: "united_forever",
                    timestamp: "2024-02-05T10:55:00Z",
                    like_count: 56
                },
                {
                    id: 8,
                    text: "Another disappointing result üòî",
                    username: "pragmatic_fan",
                    timestamp: "2024-02-05T11:00:00Z",
                    like_count: 18
                },
                {
                    id: 9,
                    text: "üêêüêêüêêüêêüêê",
                    username: "emoji_king",
                    timestamp: "2024-02-05T11:05:00Z",
                    like_count: 102
                },
                {
                    id: 10,
                    text: "Bring back SAF era glory!",
                    username: "nostalgia_fan",
                    timestamp: "2024-02-05T11:10:00Z",
                    like_count: 29
                },
                {
                    id: 11,
                    text: "Ten Hag out!",
                    username: "angry_fan",
                    timestamp: "2024-02-05T11:15:00Z",
                    like_count: 15
                },
                {
                    id: 12,
                    text: "What a goal! ü§©",
                    username: "happy_fan",
                    timestamp: "2024-02-05T11:20:00Z",
                    like_count: 78
                },
                {
                    id: 13,
                    text: "@garnacho7 future star ‚≠ê",
                    username: "youth_fan",
                    timestamp: "2024-02-05T11:25:00Z",
                    like_count: 41
                },
                {
                    id: 14,
                    text: "Glazers out! üö´",
                    username: "protest_fan",
                    timestamp: "2024-02-05T11:30:00Z",
                    like_count: 92
                },
                {
                    id: 15,
                    text: "Manchester is red! üî¥",
                    username: "city_hater",
                    timestamp: "2024-02-05T11:35:00Z",
                    like_count: 63
                }
            ]
        };

        // State management
        let state = {
            currentPost: null,
            comments: [],
            analyzedComments: [],
            currentPage: 1,
            filteredComments: [],
            analysisResults: null
        };

        // DOM Elements
        const elements = {
            analyzeBtn: document.getElementById('analyzeBtn'),
            instagramUrl: document.getElementById('instagramUrl'),
            loadingState: document.getElementById('loadingState'),
            loadingMessage: document.getElementById('loadingMessage'),
            loadingDetail: document.getElementById('loadingDetail'),
            progressBar: document.getElementById('progressBar'),
            errorState: document.getElementById('errorState'),
            errorTitle: document.getElementById('errorTitle'),
            errorMessage: document.getElementById('errorMessage'),
            tryAgainBtn: document.getElementById('tryAgainBtn'),
            resultsContainer: document.getElementById('resultsContainer'),
            postTitle: document.getElementById('postTitle'),
            postUrl: document.getElementById('postUrl'),
            postCaption: document.getElementById('postCaption'),
            postTimestamp: document.getElementById('postTimestamp'),
            postLikes: document.getElementById('postLikes'),
            postCommentsCount: document.getElementById('postCommentsCount'),
            totalCommentsBadge: document.getElementById('totalCommentsBadge'),
            analysisDate: document.getElementById('analysisDate'),
            analysisMethod: document.getElementById('analysisMethod'),
            newAnalysisBtn: document.getElementById('newAnalysisBtn'),
            downloadReportBtn: document.getElementById('downloadReportBtn'),
            dominantEmotion: document.getElementById('dominantEmotion'),
            intensityBar: document.getElementById('intensityBar'),
            dominantInteraction: document.getElementById('dominantInteraction'),
            activeUsers: document.getElementById('activeUsers'),
            ritualCount: document.getElementById('ritualCount'),
            longestChain: document.getElementById('longestChain'),
            commentsContainer: document.getElementById('commentsContainer'),
            showingComments: document.getElementById('showingComments'),
            totalComments: document.getElementById('totalComments'),
            prevComments: document.getElementById('prevComments'),
            nextComments: document.getElementById('nextComments'),
            searchComments: document.getElementById('searchComments'),
            sortComments: document.getElementById('sortComments'),
            patternsList: document.getElementById('patternsList'),
            analysisChart: document.getElementById('analysisChart'),
            patternsChart: document.getElementById('patternsChart')
        };

        // Analysis Methods
        const analysisMethods = {
            // Level 1: Sentimen (Individual)
            analyzeSentiment: (text) => {
                const lower = text.toLowerCase();
                const emojiCount = (text.match(/[\u{1F300}-\u{1F9FF}]/gu) || []).length;
                
                if (emojiCount >= 3) {
                    return {
                        category: 'Emosi Simbolik',
                        intensity: 0.9,
                        description: 'Dominasi emoji menunjukkan ekspresi emosi non-verbal yang kuat',
                        tags: ['emoji', 'simbolik', 'emosional']
                    };
                }
                
                if (/(goat|üêê|king|legend|best)/i.test(lower)) {
                    return {
                        category: 'Pengagungan',
                        intensity: 0.8,
                        description: 'Pujian terhadap pemain atau tim dengan metafora heroik',
                        tags: ['pujian', 'heroik', 'metafora']
                    };
                }
                
                if (/(sack|out|worst|pathetic|useless)/i.test(lower)) {
                    return {
                        category: 'Kritik',
                        intensity: 0.7,
                        description: 'Ekspresi kekecewaan atau ketidakpuasan',
                        tags: ['kritik', 'frustrasi', 'kekecewaan']
                    };
                }
                
                if (/(hope|wish|dream|please)/i.test(lower)) {
                    return {
                        category: 'Harapan',
                        intensity: 0.6,
                        description: 'Ekspresi harapan atau permohonan',
                        tags: ['harapan', 'optimisme', 'permohonan']
                    };
                }
                
                if (/(love|‚ù§Ô∏è|heart|miss)/i.test(lower)) {
                    return {
                        category: 'Afeksi',
                        intensity: 0.5,
                        description: 'Ekspresi kasih sayang atau kerinduan',
                        tags: ['kasih sayang', 'emosi positif', 'afeksi']
                    };
                }
                
                return {
                    category: 'Netral/Informatif',
                    intensity: 0.3,
                    description: 'Komentar dengan nada netral atau informasi',
                    tags: ['netral', 'informatif', 'faktual']
                };
            },

            // Level 2: Ekspresi (Interpersonal)
            analyzeExpression: (text, comments, index) => {
                const analysis = {
                    type: 'Individu',
                    interactions: [],
                    mentions: [],
                    hashtags: []
                };

                // Check for mentions
                const mentions = text.match(/@(\w+)/g) || [];
                analysis.mentions = mentions.map(m => m.substring(1));
                
                // Check for hashtags
                const hashtags = text.match(/#(\w+)/g) || [];
                analysis.hashtags = hashtags.map(h => h.substring(1));
                
                // Check for replies (simplified)
                if (text.includes('@')) {
                    analysis.type = 'Balasan';
                    analysis.interactions.push('direct_mention');
                }
                
                // Check for community slang
                const slang = ['siuu', 'ggmu', 'glazer', 'woodward', 'ole out', 'ten hag'];
                if (slang.some(s => text.toLowerCase().includes(s))) {
                    analysis.interactions.push('community_slang');
                }
                
                // Check for questions
                if (text.includes('?')) {
                    analysis.interactions.push('inquiry');
                }
                
                // Check for exclamations
                if ((text.match(/!/g) || []).length >= 2) {
                    analysis.interactions.push('exclamatory');
                }
                
                return analysis;
            },

            // Level 3: Ritual (Group)
            analyzeRitual: (text, comments, index) => {
                const analysis = {
                    isRitual: false,
                    type: null,
                    chainLength: 1,
                    pattern: null
                };

                // Check for pure emoji
                if (/^[\u{1F300}-\u{1F9FF}\s]+$/u.test(text.trim())) {
                    analysis.isRitual = true;
                    analysis.type = 'emoji_ritual';
                    analysis.pattern = 'pure_emoji';
                }
                
                // Check for repetition
                if (/(.)\1{2,}/.test(text)) {
                    analysis.isRitual = true;
                    analysis.type = 'repetition_ritual';
                    analysis.pattern = 'character_repetition';
                }
                
                // Check for copy-paste patterns
                if (index > 0 && text === comments[index - 1].text) {
                    analysis.isRitual = true;
                    analysis.type = 'copy_paste';
                    analysis.chainLength = 2;
                    
                    // Check for longer chains
                    let chain = 2;
                    for (let i = index - 2; i >= 0; i--) {
                        if (comments[i].text === text) {
                            chain++;
                        } else {
                            break;
                        }
                    }
                    analysis.chainLength = chain;
                }
                
                // Check for short phrases
                if (text.split(/\s+/).length <= 3) {
                    analysis.isRitual = true;
                    analysis.type = 'short_phrase';
                    analysis.pattern = 'concise_expression';
                }
                
                return analysis;
            }
        };

        // API Functions
        const api = {
            // Method 1: Instagram Graph API (requires access token)
            fetchFromInstagramAPI: async (postUrl) => {
                try {
                    // Extract post ID from URL
                    const postId = postUrl.split('/p/')[1]?.replace('/', '');
                    if (!postId) throw new Error('URL tidak valid');
                    
                    // In production, you would need to:
                    // 1. Have a backend server with Instagram access token
                    // 2. Make authenticated requests to Instagram Graph API
                    
                    // For demonstration, we'll use mock data
                    return await api.fetchMockData();
                    
                } catch (error) {
                    console.error('Instagram API Error:', error);
                    throw new Error('Gagal mengambil data dari Instagram API');
                }
            },

            // Method 2: Mock Data
            fetchMockData: async () => {
                return new Promise(resolve => {
                    setTimeout(() => {
                        resolve({
                            post: {
                                id: 'CxHhXZvqQk',
                                caption: 'Another important victory! üí™üî¥ #MUFC #GGMU',
                                timestamp: '2024-02-05T10:00:00Z',
                                like_count: 12500,
                                comments_count: 850
                            },
                            comments: CONFIG.MOCK_DATA
                        });
                    }, 1500);
                });
            },

            // Method 3: Web Scraping (requires backend)
            fetchFromScraping: async (postUrl) => {
                try {
                    // This would require a backend server with scraping capabilities
                    const response = await axios.post(`${CONFIG.BACKEND_URL}/scrape`, {
                        url: postUrl
                    });
                    return response.data;
                } catch (error) {
                    console.error('Scraping Error:', error);
                    throw new Error('Gagal mengambil data melalui scraping');
                }
            }
        };

        // UI Functions
        const ui = {
            showLoading: (message, detail) => {
                elements.loadingMessage.textContent = message || 'Memproses...';
                elements.loadingDetail.textContent = detail || 'Menyiapkan analisis';
                elements.loadingState.classList.remove('hidden');
                elements.resultsContainer.classList.add('hidden');
                elements.errorState.classList.add('hidden');
                
                // Animate progress bar
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 5;
                    elements.progressBar.style.width = `${progress}%`;
                    if (progress >= 95) clearInterval(interval);
                }, 100);
            },

            hideLoading: () => {
                elements.loadingState.classList.add('hidden');
                elements.progressBar.style.width = '100%';
            },

            showError: (title, message) => {
                elements.errorTitle.textContent = title;
                elements.errorMessage.textContent = message;
                elements.errorState.classList.remove('hidden');
                elements.loadingState.classList.add('hidden');
            },

            showResults: () => {
                elements.resultsContainer.classList.remove('hidden');
                elements.loadingState.classList.add('hidden');
                elements.errorState.classList.add('hidden');
            },

            updatePostInfo: (post) => {
                elements.postTitle.textContent = `Postingan: ${post.id}`;
                elements.postUrl.textContent = document.getElementById('instagramUrl').value;
                elements.postCaption.textContent = post.caption;
                elements.postTimestamp.textContent = new Date(post.timestamp).toLocaleDateString('id-ID', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                elements.postLikes.textContent = post.like_count.toLocaleString();
                elements.postCommentsCount.textContent = post.comments_count.toLocaleString();
                elements.totalCommentsBadge.textContent = `${post.comments_count} komentar`;
                elements.analysisDate.textContent = new Date().toLocaleDateString('id-ID');
                
                const method = document.querySelector('input[name="analysisMethod"]:checked').value;
                elements.analysisMethod.textContent = method === 'api' ? 'Instagram API' : 
                                                     method === 'scrape' ? 'Web Scraping' : 'Data Contoh';
            },

            renderComments: () => {
                const start = (state.currentPage - 1) * CONFIG.COMMENTS_PER_PAGE;
                const end = start + CONFIG.COMMENTS_PER_PAGE;
                const pageComments = state.filteredComments.slice(start, end);
                
                elements.commentsContainer.innerHTML = '';
                
                pageComments.forEach(comment => {
                    const commentDiv = document.createElement('div');
                    commentDiv.className = 'border-b border-gray-200 py-4';
                    
                    // Analysis tags
                    const sentimentTag = `<span class="analysis-tag bg-blue-100 text-blue-800">${comment.sentiment.category}</span>`;
                    const expressionTags = comment.expression.interactions.map(t => 
                        `<span class="analysis-tag bg-purple-100 text-purple-800">${t}</span>`
                    ).join('');
                    const ritualTag = comment.ritual.isRitual ? 
                        `<span class="analysis-tag bg-orange-100 text-orange-800">${comment.ritual.type}</span>` : '';
                    
                    commentDiv.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex items-center">
                                <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center mr-3">
                                    <span class="text-gray-600 text-sm font-bold">${comment.username.charAt(0).toUpperCase()}</span>
                                </div>
                                <div>
                                    <p class="font-bold text-gray-800 text-sm">${comment.username}</p>
                                    <p class="text-gray-500 text-xs">${new Date(comment.timestamp).toLocaleTimeString('id-ID', {hour: '2-digit', minute: '2-digit'})}</p>
                                </div>
                            </div>
                            <div class="flex items-center text-gray-500">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"></path>
                                </svg>
                                <span class="text-xs">${comment.like_count}</span>
                            </div>
                        </div>
                        <p class="text-gray-800 mb-3">${comment.text}</p>
                        <div class="flex flex-wrap mb-2">
                            ${sentimentTag}
                            ${expressionTags}
                            ${ritualTag}
                        </div>
                    `;
                    
                    elements.commentsContainer.appendChild(commentDiv);
                });
                
                // Update pagination
                elements.showingComments.textContent = Math.min(end, state.filteredComments.length);
                elements.totalComments.textContent = state.filteredComments.length;
                elements.prevComments.disabled = state.currentPage === 1;
                elements.nextComments.disabled = end >= state.filteredComments.length;
            },

            updateAnalysisMetrics: () => {
                // Calculate dominant emotion
                const emotionCounts = {};
                state.analyzedComments.forEach(c => {
                    emotionCounts[c.sentiment.category] = (emotionCounts[c.sentiment.category] || 0) + 1;
                });
                const dominantEmotion = Object.entries(emotionCounts).sort((a, b) => b[1] - a[1])[0];
                elements.dominantEmotion.textContent = dominantEmotion ? dominantEmotion[0] : 'Tidak ada';
                
                // Calculate average intensity
                const avgIntensity = state.analyzedComments.reduce((sum, c) => sum + c.sentiment.intensity, 0) / state.analyzedComments.length;
                elements.intensityBar.style.width = `${avgIntensity * 100}%`;
                
                // Calculate interaction types
                const interactionCounts = {};
                state.analyzedComments.forEach(c => {
                    c.expression.interactions.forEach(i => {
                        interactionCounts[i] = (interactionCounts[i] || 0) + 1;
                    });
                });
                const dominantInteraction = Object.entries(interactionCounts).sort((a, b) => b[1] - a[1])[0];
                elements.dominantInteraction.textContent = dominantInteraction ? dominantInteraction[0] : 'Tidak ada';
                
                // Count unique users
                const uniqueUsers = new Set(state.analyzedComments.map(c => c.username));
                elements.activeUsers.textContent = uniqueUsers.size;
                
                // Count rituals
                const ritualCount = state.analyzedComments.filter(c => c.ritual.isRitual).length;
                elements.ritualCount.textContent = ritualCount;
                
                // Find longest chain
                let longestChain = 0;
                let currentChain = 0;
                let currentText = '';
                
                state.analyzedComments.forEach(c => {
                    if (c.ritual.isRitual && c.ritual.type === 'copy_paste') {
                        if (c.text === currentText) {
                            currentChain++;
                        } else {
                            currentText = c.text;
                            currentChain = 1;
                        }
                        longestChain = Math.max(longestChain, currentChain);
                    }
                });
                
                elements.longestChain.textContent = longestChain > 0 ? `${longestChain} komentar` : 'Tidak ada';
            },

            updateCharts: () => {
                // Prepare data for charts
                const sentimentData = {};
                const patternData = {};
                
                state.analyzedComments.forEach(c => {
                    // Sentiment categories
                    sentimentData[c.sentiment.category] = (sentimentData[c.sentiment.category] || 0) + 1;
                    
                    // Patterns
                    if (c.ritual.isRitual) {
                        patternData[c.ritual.type] = (patternData[c.ritual.type] || 0) + 1;
                    }
                    
                    c.expression.interactions.forEach(i => {
                        patternData[i] = (patternData[i] || 0) + 1;
                    });
                });
                
                // Analysis Chart
                new Chart(elements.analysisChart, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(sentimentData),
                        datasets: [{
                            data: Object.values(sentimentData),
                            backgroundColor: ['#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
                
                // Patterns Chart
                new Chart(elements.patternsChart, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(patternData).slice(0, 10), // Top 10 patterns
                        datasets: [{
                            label: 'Frekuensi',
                            data: Object.values(patternData).slice(0, 10),
                            backgroundColor: '#a855f7'
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            },

            updatePatternsList: () => {
                // Collect unique patterns
                const patterns = new Set();
                state.analyzedComments.forEach(c => {
                    patterns.add(c.sentiment.category);
                    c.expression.interactions.forEach(i => patterns.add(i));
                    if (c.ritual.isRitual) {
                        patterns.add(c.ritual.type);
                    }
                });
                
                elements.patternsList.innerHTML = '';
                Array.from(patterns).slice(0, 8).forEach(pattern => {
                    const patternDiv = document.createElement('div');
                    patternDiv.className = 'bg-white p-3 rounded-lg border border-blue-100';
                    patternDiv.innerHTML = `
                        <div class="flex items-center">
                            <div class="w-2 h-2 rounded-full bg-blue-500 mr-3"></div>
                            <span class="text-sm font-medium text-gray-800">${pattern}</span>
                        </div>
                    `;
                    elements.patternsList.appendChild(patternDiv);
                });
            }
        };

        // Main Analysis Function
        async function analyzeInstagramPost() {
            const url = elements.instagramUrl.value.trim();
            const method = document.querySelector('input[name="analysisMethod"]:checked').value;
            
            if (!url) {
                ui.showError('URL Kosong', 'Masukkan URL postingan Instagram terlebih dahulu');
                return;
            }
            
            if (!url.includes('instagram.com/p/')) {
                ui.showError('URL Tidak Valid', 'URL harus berupa postingan Instagram (mengandung /p/)');
                return;
            }
            
            try {
                // Show loading
                ui.showLoading(
                    'Mengambil data dari Instagram...',
                    'Ini mungkin memerlukan beberapa saat'
                );
                
                // Fetch data based on selected method
                let data;
                switch (method) {
                    case 'api':
                        data = await api.fetchFromInstagramAPI(url);
                        break;
                    case 'scrape':
                        data = await api.fetchFromScraping(url);
                        break;
                    case 'mock':
                    default:
                        data = await api.fetchMockData();
                        break;
                }
                
                // Update state
                state.currentPost = data.post;
                state.comments = data.comments;
                
                // Perform 3-level analysis
                state.analyzedComments = state.comments.map((comment, index) => ({
                    ...comment,
                    sentiment: analysisMethods.analyzeSentiment(comment.text),
                    expression: analysisMethods.analyzeExpression(comment.text, state.comments, index),
                    ritual: analysisMethods.analyzeRitual(comment.text, state.comments, index)
                }));
                
                state.filteredComments = [...state.analyzedComments];
                state.currentPage = 1;
                
                // Update UI
                ui.hideLoading();
                ui.updatePostInfo(state.currentPost);
                ui.renderComments();
                ui.updateAnalysisMetrics();
                ui.updateCharts();
                ui.updatePatternsList();
                ui.showResults();
                
            } catch (error) {
                console.error('Analysis Error:', error);
                ui.showError(
                    'Gagal Menganalisis',
                    error.message || 'Terjadi kesalahan saat menganalisis postingan'
                );
            }
        }

        // Event Listeners
        elements.analyzeBtn.addEventListener('click', analyzeInstagramPost);

        elements.tryAgainBtn.addEventListener('click', () => {
            elements.errorState.classList.add('hidden');
            analyzeInstagramPost();
        });

        elements.newAnalysisBtn.addEventListener('click', () => {
            elements.resultsContainer.classList.add('hidden');
            elements.instagramUrl.value = '';
            elements.instagramUrl.focus();
        });

        elements.downloadReportBtn.addEventListener('click', () => {
            // Generate and download report
            const report = {
                post: state.currentPost,
                analysisDate: new Date().toISOString(),
                totalComments: state.analyzedComments.length,
                sentimentSummary: {},
                expressionSummary: {},
                ritualSummary: {},
                sampleComments: state.analyzedComments.slice(0, 10)
            };
            
            // Calculate summaries
            state.analyzedComments.forEach(c => {
                report.sentimentSummary[c.sentiment.category] = (report.sentimentSummary[c.sentiment.category] || 0) + 1;
                
                c.expression.interactions.forEach(i => {
                    report.expressionSummary[i] = (report.expressionSummary[i] || 0) + 1;
                });
                
                if (c.ritual.isRitual) {
                    report.ritualSummary[c.ritual.type] = (report.ritualSummary[c.ritual.type] || 0) + 1;
                }
            });
            
            // Create and download JSON file
            const dataStr = JSON.stringify(report, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `analisis-instagram-${state.currentPost?.id || 'report'}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        });

        elements.prevComments.addEventListener('click', () => {
            if (state.currentPage > 1) {
                state.currentPage--;
                ui.renderComments();
            }
        });

        elements.nextComments.addEventListener('click', () => {
            if ((state.currentPage * CONFIG.COMMENTS_PER_PAGE) < state.filteredComments.length) {
                state.currentPage++;
                ui.renderComments();
            }
        });

        elements.searchComments.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            if (searchTerm) {
                state.filteredComments = state.analyzedComments.filter(c => 
                    c.text.toLowerCase().includes(searchTerm) ||
                    c.username.toLowerCase().includes(searchTerm) ||
                    c.sentiment.category.toLowerCase().includes(searchTerm)
                );
            } else {
                state.filteredComments = [...state.analyzedComments];
            }
            state.currentPage = 1;
            ui.renderComments();
        });

        elements.sortComments.addEventListener('change', (e) => {
            const sortBy = e.target.value;
            switch (sortBy) {
                case 'newest':
                    state.filteredComments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    break;
                case 'oldest':
                    state.filteredComments.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                    break;
                case 'sentiment':
                    state.filteredComments.sort((a, b) => b.sentiment.intensity - a.sentiment.intensity);
                    break;
                case 'length':
                    state.filteredComments.sort((a, b) => b.text.length - a.text.length);
                    break;
            }
            state.currentPage = 1;
            ui.renderComments();
        });

        // Initialize with example URL
        elements.instagramUrl.addEventListener('focus', function() {
            if (this.value === 'https://www.instagram.com/p/CxHhXZvqQk/') {
                this.select();
            }
        });

        // Enter key to analyze
        elements.instagramUrl.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                analyzeInstagramPost();
            }
        });
    </script>
</body>
</html>